%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Copyright © 2022 Maximilian Keßler
% 
% This work may be distributed and/or modified
% 
% 1. under the LaTeX Project Public License and/or
% 2. under the GNU General Public License
% 
% Distribution under conditions of the LaTeX Project Public License,
% requires either version 1.3 of this license or (at your option)
% any later version.
% The latest version of this license is in
%    http://www.latex-project.org/lppl.txt
% and version 1.3 or later is part of all distributions of LaTeX
% version 2005/12/01 or later.
% 
% This work has the LPPL maintenance status \`maintained'.
% 
% The Current Maintainer of this work is Maximilian Keßler.
% 
% 
% Distribution under the GNU General Public License requires either
% version 3 or (at your opinion) any later version.
% 
% This package has been generated by PyTeX, available at
%    https://github.com/kesslermaximilian/PyTeX
% and built from source file 'mathfig.pysty'.
% It is STRONGLY DISCOURAGED to edit this source file directly, since local
% changes will not be versioned by Git and overwritten by the next build. Always
% edit the source file and build the package again.
% 
% Build details:
%   PyTeX version: v1.2.0-31-gc9bb0e8 (commit c9bb0e8)
%   Source code version: v2.9-27-g2d16a2d (commit 2d16a2d)
% 
% This LaTeX package is free software and is dual-licensed
% under the LPPLv1.3c and the GPLv3 licenses.
% You may use it freely for your purposes.
% The latest version of the package sources can be obtained
% via GitLab under
%    https://gitlab.com/latexci/packages/LatexPackages
% The latest version of the built packages can be obtained via GitLab under
%    https://gitlab.com/latexci/packages/LatexPackagesBuild
% For further information see the urls above.
% Reportings of bugs, suggestions and improvements are welcome, see the README
% at the Git repository for further information.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{mkessler-mathfig}[2022/06/27 - Math figures with TikZ / pgfplots / xy]


% This is just a collection of the packages I use to typeset mathematical figures
% most commonly plots, commutative diagrams or geometry



\RequirePackage{pgfplots} % Plots
\pgfplotsset{compat=1.7}

\RequirePackage{tikz} % Plots / drawings
\usetikzlibrary{calc, intersections, through, quotes, angles, babel, positioning, snakes, decorations.markings}

\RequirePackage{tikz-cd} %Commutative diagrams
\RequirePackage{xparse}


%%for small diagrams, similar to tikz-cd
\RequirePackage[all]{xy}        % for small diagrams, e.g. arrows
%%% In older versions, you found 
% \RequirePackage{xy}
% \xyoption{all}
% here, but this messes with the catcode of the @ sign (which no package should do!)
% so that further parts in this package would get broken


\newcommand\pushoutsymbol{\tikz[baseline=0.5,scale=0.2]{
        \draw[-] (0,0) --(0,1) -- (1,1);
    \draw (1,0) circle (1.5pt);}
}

\newcommand\pullbacksymbol{\tikz[baseline=0.5,scale=0.2]{
        \draw[-] (0,0) --(1,0) -- (1,1);
    \draw (0,1) circle (1.5pt);}
}

% This is used in a tikzcd
\NewDocumentCommand\pushout{ O{dr} }{
    \arrow[phantom, pos=0.45]{#1}{\pushoutsymbol}
}

% This is used in a tikzcd
\NewDocumentCommand\pullback{ O{dr} }{
    \arrow[phantom, pos=0.45]{#1}{\pullbacksymbol}
}


%% Fix for equal arrows in tikz, see
% https://tex.stackexchange.com/questions/443017/equal-arrows-without-transparent-ends-possible-in-tikzcd

\tikzset {
  double line with arrow/.style args = 
    {#1,#2}%
    {
      decorate, decoration =
        {
          markings,
          mark = at position 0 with
            {
              \coordinate (ta-base-1) at (0,1pt);
              \coordinate (ta-base-2) at (0,-1pt);
            }
          ,
          mark = at position 1 with
            {
              \draw[#1] (ta-base-1) -- (0,1pt);
              \draw[#2] (ta-base-2) -- (0,-1pt);
            }
        }
    }
}

\tikzset{Equal/.style={-,double line with arrow={-,-}}}
